<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="./styles/style.css" />
    <title> Calculator </title>
    <link rel="icon" href="./images/calculator-icon.jpg" type="image/x-icon">
</head>

<body> 
    <div class="calculator">
        <div class="screenBody">
            <div class="screen">  
                <input class="screenText1" type="text" value="" disabled /> <br>
                <input class="screenText2" type="text" disabled /> 
            </div>
        </div>

        <div class="mainBody">
            <button class="sqrt" onclick='operate("sqrt")'> 
                &radic;<span style="text-decoration:overline;">&nbsp;&nbsp;</span> 
            </button>
            <button class="seven" onclick='operate("7")'> 7 </button> 
            <button class="eight" onclick='operate("8")'> 8 </button> 
            <button class="nine" onclick='operate("9")'> 9 </button>
            <button class="divide" onclick='operate("/")'> ÷ </button>  <br>
            <button class="negation" onclick='operate("neg")'> +/− </button>
            <button class="four" onclick='operate("4")'> 4 </button>
            <button class="five" onclick='operate("5")'> 5 </button> 
            <button class="six" onclick='operate("6")'> 6 </button>
            <button class="multiply" onclick='operate("*")'> × </button> <br>
            <button class="delete" onclick='operate("del")'> Del </button>
            <button class="one" onclick='operate("1")'> 1 </button>
            <button class="two" onclick='operate("2")'> 2 </button>
            <button class="three" onclick='operate("3")'> 3 </button>
            <button class="minus" onclick='operate("-")'> − </button> <br>
            <button class="clear" onclick='operate("ce")'> CE </button>
            <button class="zero" onclick='operate("0")'> 0 </button>
            <button class="dot" onclick='operate(".")'> . </button>
            <button class="equals" onclick='operate("=")'> = </button>
            <button class="plus" onclick='operate("+")'> + </button>
        </div>
    </div>

    <div class="instructions">
        <p>
            Keybinds: <br>
            Multiplication ×: x <br>
            Negation +/−: n <br>
            Square Root &radic;: s <br>
            Clear CE: ESCAPE <br>
        </p>
    </div>

    <script>
        //  ************ Eventlistener for keypress  ************
        
        document.addEventListener('keydown', function(event) {
            if (event.keyCode == 48 || event.keyCode == 96) {
                document.getElementsByClassName("zero")[0].click();
            } else if (event.keyCode == 49 || event.keyCode == 97) {
                document.getElementsByClassName("one")[0].click();
            } else if (event.keyCode == 50 || event.keyCode == 98) {
                document.getElementsByClassName("two")[0].click();
            } else if (event.keyCode == 51 || event.keyCode == 99) {
                document.getElementsByClassName("three")[0].click();
            } else if (event.keyCode == 52 || event.keyCode == 100) {
                document.getElementsByClassName("four")[0].click();
            } else if (event.keyCode == 53 || event.keyCode == 101) {
                document.getElementsByClassName("five")[0].click();
            } else if (event.keyCode == 54 || event.keyCode == 102) {
                document.getElementsByClassName("six")[0].click();
            } else if (event.keyCode == 55 || event.keyCode == 103) {
                document.getElementsByClassName("seven")[0].click();
            } else if (event.keyCode == 56 || event.keyCode == 104) {
                document.getElementsByClassName("eight")[0].click();
            } else if (event.keyCode == 57 || event.keyCode == 105) {
                document.getElementsByClassName("nine")[0].click();
            } else if (event.keyCode == 187) {
                document.getElementsByClassName("plus")[0].click();
            } else if (event.keyCode == 189) {
                document.getElementsByClassName("minus")[0].click();
            } else if (event.keyCode == 88) {
                document.getElementsByClassName("multiply")[0].click();
            } else if (event.keyCode == 191) {
                document.getElementsByClassName("divide")[0].click();
            } else if (event.keyCode == 83) {
                document.getElementsByClassName("sqrt")[0].click();
            } else if (event.keyCode == 190) {
                document.getElementsByClassName("dot")[0].click();
            } else if (event.keyCode == 8) {
                document.getElementsByClassName("delete")[0].click();
            } else if (event.keyCode == 27) {
                document.getElementsByClassName("clear")[0].click();
            } else if (event.keyCode == 13) {
                document.getElementsByClassName("equals")[0].click();
            } else if (event.keyCode == 78) {
                document.getElementsByClassName("negation")[0].click();
            }
        } );

        //  *****************************************************

        var dotPressed = false;
        var operator = "";
        var firstNum = 0;
        var secondNum = 0;
        var sqrtOn = false;

        function operate(key)
        {
            var secondScreen = document.getElementsByClassName("screenText2")[0].value;
            if (key == "=")
            {
                if (operator.length != 0)
                {
                    if (secondNum == 0) secondNum = Number(secondScreen);
                    if (secondNum.toString().includes("."))
                    {
                        secondNum = Number(secondNum.toFixed(2));
                    } else {
                        secondNum = Number(secondNum);
                    }
                    if (!sqrtOn) document.getElementsByClassName("screenText1")[0].value += secondNum.toString();
                    calculate();
                    fixDecimal();
                    sqrtOn = false;
                }
            } else if (key == "+" || key == "-" || key == "*" || key == "/") {

                if (operator.length != 0)   // there is an active operator
                {
                    if (secondNum == 0) secondNum = Number(secondScreen);
                    calculate();
                    fixDecimal();
                    document.getElementsByClassName("screenText1")[0].value = firstNum.toString();
                    operator = key;
                    if (key == "+")
                    {
                        document.getElementsByClassName("screenText1")[0].value += " + ";
                    } else if (key == "-") {
                        document.getElementsByClassName("screenText1")[0].value += " − ";
                    } else if (key == "*") { 
                        document.getElementsByClassName("screenText1")[0].value += " × ";
                    } else {
                        document.getElementsByClassName("screenText1")[0].value += " ÷ ";
                    }
                    document.getElementsByClassName("screenText2")[0].value = "";
                } 
                  
                if (operator.length == 0 && secondScreen.length != 0)   // no active operator
                {
                    operator = key;
                    dotPressed = false;
                    if (firstNum == 0) firstNum = Number(secondScreen);
                    fixDecimal();
                    document.getElementsByClassName("screenText1")[0].value = firstNum;
                    if (key == "+")
                    {
                        document.getElementsByClassName("screenText1")[0].value += " + ";
                    } else if (key == "-") {
                        document.getElementsByClassName("screenText1")[0].value += " − ";
                    } else if (key == "*") { 
                        document.getElementsByClassName("screenText1")[0].value += " × ";
                    } else {
                        document.getElementsByClassName("screenText1")[0].value += " ÷ ";
                    }
                    document.getElementsByClassName("screenText2")[0].value = "";
                }
            } else if (key == "sqrt" || key == "neg") {
                if (key == "sqrt")
                {
                    if (operator.length == 0)
                    {
                        firstNum = Number(secondScreen);
                        if (firstNum >= 0)
                        {
                            document.getElementsByClassName("screenText1")[0].value 
                                     = '√' + firstNum.toString();
                            firstNum = Math.sqrt(firstNum);
                            document.getElementsByClassName("screenText2")[0].value = firstNum.toString();
                            fixDecimal();
                        }
                    } 

                    if (operator.length != 0)
                    {
                        secondNum = Number(secondScreen);
                        if (secondNum >= 0)
                        {
                            document.getElementsByClassName("screenText1")[0].value 
                                    += '√' + secondNum.toString();
                            secondNum = Math.sqrt(secondNum);
                            document.getElementsByClassName("screenText2")[0].value = secondNum.toString();
                            fixDecimal();
                            sqrtOn = true;
                        }
                    }
 
                    if (firstNum < 0 || secondNum < 0)
                    {
                        document.getElementsByClassName("screenText1")[0].value = "ERROR: SQRT < 0";
                        document.getElementsByClassName("screenText2")[0].value = "";
                        firstNum = 0;
                        secondNum = 0;
                        dotPressed = false;
                        operator = "";
                     }
                }

                if (key == "neg")
                {
                    if (operator.length == 0)
                    {
                        firstNum = Number(secondScreen);
                        if (firstNum > 0)
                        {
                            firstNum = firstNum * -1;
                            document.getElementsByClassName("screenText2")[0].value = firstNum.toString();
                        }
                    }
                        
                    if (operator.length != 0)
                    {
                        secondNum = Number(secondScreen);
                        if (secondNum > 0)
                        {
                            secondNum = secondNum * -1;
                            document.getElementsByClassName("screenText2")[0].value = secondNum.toString();
                        }
                    }
                }
            } else if (key == "del") {
                document.getElementsByClassName("screenText2")[0].value
                    = secondScreen.substring(0, secondScreen.length - 1);
            } else if (key == "ce") {
                dotPressed = false;
                operator = "";
                firstNum = 0;
                secondNum = 0;
                document.getElementsByClassName("screenText1")[0].value = "";
                document.getElementsByClassName("screenText2")[0].value = "";
            } else {
                if (key == ".") 
                {
                    if (!dotPressed && secondScreen.length != 0)    // decimal dot can be pressed only once
                    {
                        document.getElementsByClassName("screenText2")[0].value += key;
                        dotPressed = true;
                    }
                } else {
                    if (key != "0" || secondScreen != "0") // cannot spam 0's in front
                    {
                        document.getElementsByClassName("screenText2")[0].value += key;
                        secondScreen = document.getElementsByClassName("screenText2")[0].value;
                        if (secondScreen.substring(0,1) == "0" && secondScreen.substring(1,2) != "." &&
                        secondScreen.length > 1) // remove 0 in front
                        {
                            document.getElementsByClassName("screenText2")[0].value = secondScreen.substring(1, secondScreen.length);
                        }
                    }
                }
            }
        }

        function fixDecimal()
        {
            if (secondNum.toString().includes("."))
            {
                var num = Number(document.getElementsByClassName("screenText2")[0].value);
                document.getElementsByClassName("screenText2")[0].value = num.toFixed(2);
                firstNum = Number(num.toFixed(2));
            }
        }

        function calculate()
        {
            var calculatedNum

            if (operator == "+")
            {
                calculatedNum = firstNum + secondNum;
            } else if (operator == "-") {
                calculatedNum = firstNum - secondNum;
            } else if (operator == "*") {
                calculatedNum = firstNum * secondNum;
            } else if (operator == "/") { 
                if (secondNum == 0)
                {
                    document.getElementsByClassName("screenText1")[0].value = "ERROR: 0 DENOM";
                    document.getElementsByClassName("screenText2")[0].value = "";
                    firstNum = 0;
                    secondNum = 0;
                    dotPressed = false;
                    operator = "";
                    return;
                } else {
                    calculatedNum = firstNum / secondNum;
                }
            }
 
            document.getElementsByClassName("screenText2")[0].value = calculatedNum;
            operator = "";
            firstNum = calculatedNum;
            secondNum = 0;
            dotPressed = false;
        }
    </script>
</body>

</html>